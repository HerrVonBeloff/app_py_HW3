# Сервис сокращения ссылок

## Описание проекта
Это FastAPI-приложение для сокращения длинных URL-адресов с возможностью:
- Создания временных (24 часа) и постоянных ссылок
- Управления ссылками (создание, просмотр, обновление, удаление)
- Авторизации пользователей
- Кэширования популярных ссылок в Redis
- Автоматической очистки устаревших ссылок

## Основные сущности

### Пользователь (User)
- `username` - уникальное имя пользователя
- `email` - электронная почта
- `hashed_password` - хэшированный пароль
- `is_active` - статус активности

### Ссылка (Link)
- `original_url` - оригинальный длинный URL
- `short_code` - сокращенный код (6 символов по умолчанию или кастомный)
- `created_at` - дата создания
- `expires_at` - срок действия (для временных ссылок)
- `is_permanent` - флаг постоянной ссылки
- `last_accessed` - дата последнего перехода
- `clicks` - количество переходов
- `owner_id` - ID владельца (если есть)

## API Endpoints

### Без авторизации
- `POST /register` - регистрация нового пользователя
- `POST /token` - получение JWT-токена
- `GET /{short_code}` - перенаправление по короткой ссылке
- `GET /links/{short_code}/stats` - статистика по ссылке
- `GET /links/{short_code}/original` - получение оригинального URL

### Требуется авторизация
- `POST /links/shorten` - создание сокращенной ссылки
- `DELETE /links/{short_code}` - удаление ссылки
- `PUT /links/{short_code}` - обновление ссылки
- `POST /links/{short_code}/set_expiry` - установка срока действия
## Хранение данных
Основное хранилище данных - PostgreSQL. Все сущности (пользователи, ссылки) сохраняются в реляционной БД с использованием SQLAlchemy ORM.
## Особенности реализации

1. **Авторизация**:
   - Используется JWT-токен
   - Токен передается в заголовке `Authorization: Bearer <token>`

2. **Ссылки**:
   - Анонимные пользователи могут создавать только временные ссылки (24 часа)
   - Авторизованные пользователи могут создавать постоянные ссылки
   - Можно указать кастомный короткий код (не менее 4 символов)

3. **Кэширование**:
   - Используется Redis для кэширования популярных ссылок
   - Время жизни кэша - 1 час

4. **Очистка**:
   - Автоматическая очистка устаревших ссылок каждые 5 минут
   - Удаляются:
     - Временные ссылки с истекшим сроком
     - Неактивные ссылки (более 7 дней без переходов)
